<!-- == README.md == -->
# Multiplier Generator Service

HTTP-сервис и CLI-утилита для генерации числовых множителей на основе различных экспериментальных алгоритмов.  
Предназначен для тестирования сходимости RTP в условиях разных трансформаций последовательности.

> **Внимание**: реализация алгоритмов экспериментальная. Формальные требования уточняются — см. [README_QUESTIONS.md](./README_QUESTIONS.md).

---

## Сборка

```bash
make all
```

Бинарники будут созданы в папке `bin/`:

- `bin/multgen` — генератор множителей
- `bin/check` — утилита для проверки RTP на сгенерированной последовательности

---

## Запуск

### HTTP-сервер (по умолчанию)

Запускает сервер на `localhost:64333`, возвращает множитель по запросу `/get`.

```bash
bin/multgen -rtp=0.95
```
<span style="font-size: 0.8em; color: #666;">**Note:** Для соответствия ТЗ доступен запуск из корня проекта: ```bash go run -- . -rtp=<значение>```</span>

Пример запроса:
```bash
curl http://localhost:64333/get
# {"result":10000}
```

---

### CLI-режим

Генерирует N множителей и выводит их в stdout — один на строку.

```bash
echo 10 | bin/multgen -rtp=0.9 -cli
```

---

### Проверка RTP с `bin/check`

Утилита `check` моделирует "клиентскую последовательность" и вычисляет фактический RTP.
`check` использует псевдослучайную последовательность значений в диапазоне `[min, max]`.


#### Пример: алгоритм `v1`

```bash
echo 10000 | bin/multgen -cli -rtp=0.5 -algo=v1 | bin/check
# 2025/09/23 21:38:14 count=10000 elapsed=0s payment=49764847.020 profit=25028625.875 max_multiplier=10000.000
# 0.5029378642406565
```

-> RTP ≈ 0.5 — сходится.

#### Пример: алгоритм `v2`

```bash
echo 10000 | bin/multgen -cli -rtp=0.5 -algo=v2 | bin/check -max=1
# 2025/09/23 21:38:30 count=10000 elapsed=1.677ms payment=10000.000 profit=4972.000 max_multiplier=1.000
# 0.4972
```

-> Последовательность значений в `[1.0, 1.0]`, трансформация `x` → RTP ≈ 0.5.

#### Пример: алгоритм `v3` с трансформацией `x * m`

```bash
echo 10000000 | bin/multgen -cli -rtp=0.5 -algo=v3 | bin/check -max=1 -m
# 2025/09/23 21:39:33 count=10000000 elapsed=1.375124s payment=10000000.000 profit=4922880.929 max_multiplier=9641.521
# 0.49228809293427195
```

-> При `transform = x * m` и рациональном клиенте (`x` в `[1.0, 1.0]`) RTP сходится к 0.5 на больших выборках.

---

## Доступные алгоритмы (`-algo`)

| Алгоритм | Описание |
|----------|----------|
| `v1`     | С вероятностью `rtp` возвращает `10000`, иначе `1`. Сходится при длине > 10000 для `transform=x`. |
| `v2`     | С вероятностью `rtp` возвращает `1.000000001`, иначе `1.0`. Сходится при длине > 10000 для `transform=x` и `x*m` (при рациональном клиенте). |
| `v3`     | Генерирует `m` по распределению `exp(-k*x)`, возвращает его с вероятностью `rtp/m`, иначе `1.0`. Сходится при длине > 1e8 для `transform=x*m` (при рациональном клиенте). Распределение начинается от `1.0`, `max` можно ограничить для тестов. |
| `stub`   | Всегда возвращает `1.0`. |

> Подробнее: при запуске `bin/multgen -help`

---

## Флаги

### Для `multgen`:

| Флаг | Описание |
|------|----------|
| `-rtp` | Целевой RTP (в `(0.0, 1.0]`) — **обязательный** |
| `-no-check-rtp` | Отключает проверку RTP (только для тестов) |
| `-algo` | Алгоритм генерации: `v1`, `v2`, `v3`, `stub` |
| `-min` | Минимальное значение множителя (настройка, пока не используется) |
| `-max` | Максимальное значение множителя (используется в `v3`) |
| `-k` | Параметр `k` в `exp(-k*x)` (для `v3`, по умолчанию 15) |
| `-cli` | CLI-режим: читает N из stdin, выводит N множителей в stdout |
| `-http` | Адрес HTTP-сервера (по умолчанию `localhost:64333`) |

### Для `check`:

| Флаг | Описание |
|------|----------|
| `-min` | Минимальное значение в последовательности (по умолчанию 1.0) |
| `-max` | Максимальное значение в последовательности (по умолчанию 10000.0) |
| `-m`   | Если указан — трансформация `x * m`, иначе `x` |

---

## Структура проекта


- `cmd/multgen/` — точка входа
- `internal/cmd/multgen/` — логика main (вынесена для переиспользования)
- `internal/api/` — HTTP-обработчики
- `internal/config/` — конфигурация и флаги
- `internal/solver/` — реализация алгоритмов генерации множителей
- `main.go` — для копирования на тестовую платформу
- `pkg/app/` — импорты для main.go, чтобы можно было запустить из другого модуля 

---

## Замечания

- Алгоритмы реализованы "as is" — для разных теоретических сценариев.
- ЛЮБОЙ алгоритм бессилен пред последовательностью состоящей только из 10000. 
В этом случае, `RTP` ВСЕГДА равен 0, вне зависимости от `multiplier`.
